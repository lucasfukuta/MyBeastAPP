<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MyBeast.ViewModels.Workout"
             xmlns:toolkit="clr-namespace:CommunityToolkit.Maui.Behaviors;assembly=CommunityToolkit.Maui"
             x:Class="MyBeast.Views.Workout.WorkoutListPage"
             Title="Treinos"
             BackgroundColor="#000000"
             Shell.NavBarIsVisible="False">

    <ContentPage.BindingContext>
        <vm:WorkoutListViewModel />
    </ContentPage.BindingContext>

    <Grid RowDefinitions="Auto, Auto, *" RowSpacing="15">

        <Border Grid.Row="0" 
                StrokeThickness="0"
                StrokeShape="RoundRectangle 0,0,30,30"
                Margin="0,0,0,0">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#9747FF" Offset="0.0" />
                    <GradientStop Color="#6222CC" Offset="1.0" />
                </LinearGradientBrush>
            </Border.Background>

            <VerticalStackLayout Padding="20,20,20,30" Spacing="15">
                <Label Text="Meus Treinos" 
                       TextColor="White" 
                       FontSize="24" 
                       FontAttributes="Bold" />

                <Border BackgroundColor="#33FFFFFF" 
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 10"
                        HeightRequest="45"
                        Padding="15,0">
                    <Grid ColumnDefinitions="Auto, *">
                        <Entry Grid.Column="1" 
                               Placeholder="Buscar treinos..." 
                               PlaceholderColor="#D1D1D6"
                               TextColor="White"
                               FontSize="14"
                               VerticalOptions="Center" />
                    </Grid>
                </Border>
            </VerticalStackLayout>
        </Border>

        <Grid Grid.Row="1" ColumnDefinitions="*, Auto" ColumnSpacing="10" Margin="20,0">
            <Button Grid.Column="0"
                    Text="+  Novo Treino"
                    TextColor="White"
                    FontAttributes="Bold"
                    CornerRadius="12"
                    HeightRequest="50"
                    Command="{Binding CreateWorkoutCommand}">
                <Button.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="#FF8A65" Offset="0.0" />
                        <GradientStop Color="#FF4081" Offset="1.0" />
                    </LinearGradientBrush>
                </Button.Background>
            </Button>

            <Button Grid.Column="1"
                    ImageSource="chart_column_solid.png" 
                    BackgroundColor="#1C1C1E"
                    HeightRequest="50"
                    WidthRequest="50"
                    CornerRadius="12"
                    Padding="12" 
                    Command="{Binding GoToStatsCommand}">
                <Button.Shadow>
                    <Shadow Brush="Black" Offset="0,2" Radius="5" Opacity="0.5"/>
                </Button.Shadow>
            </Button>
        </Grid>

        <CollectionView Grid.Row="2" ItemsSource="{Binding Workouts}" Margin="20,0">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="5" />
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border BackgroundColor="#1C1C1E" 
                StrokeThickness="1"
                Stroke="#2C2C2E"
                StrokeShape="RoundRectangle 15" 
                Padding="15">

                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:WorkoutListViewModel}}, Path=SelectWorkoutCommand}"
                                      CommandParameter="{Binding .}" />
                        </Border.GestureRecognizers>

                        <Grid ColumnDefinitions="*, Auto" ColumnSpacing="10">

                            <VerticalStackLayout Grid.Column="0" Spacing="8" VerticalOptions="Center">

                                <Label Text="{Binding Name}" 
                           TextColor="White" 
                           FontSize="17" 
                           FontAttributes="Bold" 
                           LineBreakMode="TailTruncation"/>

                                <Border BackgroundColor="#2C2C2E" 
                            StrokeThickness="0" 
                            StrokeShape="RoundRectangle 6" 
                            Padding="8,4"
                            HorizontalOptions="Start">
                                    <Label Text="{Binding Level}" 
                               TextColor="{Binding LevelColor}" 
                               FontSize="10" 
                               FontAttributes="Bold"
                               TextTransform="Uppercase"/>
                                </Border>

                                <HorizontalStackLayout Spacing="15">
                                    <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                                        <Image Source="clock_icon.png" HeightRequest="14" WidthRequest="14" Aspect="AspectFit"/>
                                        <Label Text="{Binding Duration, StringFormat='{0} min'}" TextColor="#9DA3B4" FontSize="12"/>
                                    </HorizontalStackLayout>

                                    <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                                        <Image Source="fire_icon.png" HeightRequest="14" WidthRequest="14" Aspect="AspectFit"/>
                                        <Label Text="{Binding Calories, StringFormat='{0} kcal'}" TextColor="#9DA3B4" FontSize="12"/>
                                    </HorizontalStackLayout>
                                </HorizontalStackLayout>
                            </VerticalStackLayout>

                            <VerticalStackLayout Grid.Column="1" Spacing="10" VerticalOptions="Center">

                                <Button Text="Editar"
                            TextColor="White"
                            BackgroundColor="#333333"
                            FontSize="11"
                            HeightRequest="35"
                            WidthRequest="70"
                            CornerRadius="8"
                            Padding="0"
                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:WorkoutListViewModel}}, Path=EditWorkoutCommand}"
                            CommandParameter="{Binding .}"/>

                                <Button Text="Excluir"
                            TextColor="White"
                            BackgroundColor="#FF453A"
                            FontSize="11"
                            HeightRequest="35"
                            WidthRequest="70"
                            CornerRadius="8"
                            Padding="0"
                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:WorkoutListViewModel}}, Path=DeleteWorkoutCommand}"
                            CommandParameter="{Binding .}"/>
                            </VerticalStackLayout>

                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
            <CollectionView.Footer>
                <BoxView HeightRequest="20" Color="Transparent"/>
            </CollectionView.Footer>
        </CollectionView>
    </Grid>
</ContentPage>